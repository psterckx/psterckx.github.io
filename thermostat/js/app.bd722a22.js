(function(t){function e(e){for(var s,n,o=e[0],u=e[1],l=e[2],d=0,h=[];d<o.length;d++)n=o[d],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&h.push(r[n][0]),r[n]=0;for(s in u)Object.prototype.hasOwnProperty.call(u,s)&&(t[s]=u[s]);c&&c(e);while(h.length)h.shift()();return i.push.apply(i,l||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],s=!0,o=1;o<a.length;o++){var u=a[o];0!==r[u]&&(s=!1)}s&&(i.splice(e--,1),t=n(n.s=a[0]))}return t}var s={},r={app:0},i=[];function n(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=s,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(a,s,function(e){return t[e]}.bind(null,s));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/thermostat/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var c=u;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";a("85ec")},"56d7":function(t,e,a){"use strict";a.r(e);var s=a("2b0e"),r=a("8c4f"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"m-4 mt-5",attrs:{id:"app"}},[a("div",{staticClass:"container"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 text-center fs-1",class:{"fw-bold":t.delta}},[t._v(" "+t._s(t.isAuthTokenValid?t.delta?t.userDesiredTemperature:t.state?t.state.reported.thermostat_temperature:"??":"??")+" ")]),a("div",{staticClass:"col-12 text-center mb-2"},[t._v("Set Temperature")]),a("div",{staticClass:"col-12 text-center fs-3"},[t._v(" "+t._s(t.isAuthTokenValid&&t.state&&t.state.reported.measured_temperature?Math.round(t.state.reported.measured_temperature):"??")+" ")]),a("div",{staticClass:"col-12 text-center mb-5"},[t._v("Measured Temperature")]),a("div",{staticClass:"col-5 offset-1 text-center"},[a("button",{staticClass:"btn btn-secondary w-100",attrs:{type:"button",disabled:t.isRequestInFlight||t.inErrorState||!t.isDeviceOnline},on:{click:function(e){return t.updateUserDesiredTemperature(-1)}}},[t._v(" decrease ")])]),a("div",{staticClass:"col-5 text-center mb-2"},[a("button",{staticClass:"btn btn-secondary w-100",attrs:{type:"button",disabled:t.isRequestInFlight||t.inErrorState||!t.isDeviceOnline},on:{click:function(e){return t.updateUserDesiredTemperature(1)}}},[t._v(" increase ")])]),a("div",{staticClass:"col-10 offset-1 text-center mb-2"},[a("button",{staticClass:"btn w-100",class:{"btn-secondary":!t.delta,"btn-success":t.delta},attrs:{type:"button",disabled:!(t.delta&&!t.isRequestInFlight)||t.inErrorState||!t.isDeviceOnline},on:{click:function(e){return t.flight(t.updateSetTemperature,[t.userDesiredTemperature])}}},[t._v(" update ")])]),a("div",{staticClass:"col-10 offset-1 text-center mb-5"},[a("button",{staticClass:"btn btn-primary w-100",attrs:{type:"button",disabled:t.isRequestInFlight||!t.isAuthTokenValid},on:{click:function(e){return t.flight(t.getDeviceShadowState)}}},[t._v(" refresh ")])]),a("div",{staticClass:"col-12 text-center d-flex justify-content-center mb-5"},[a("span",{staticClass:"dot mx-2",class:{"device-online":t.isDeviceOnline,"device-state-unknown":!t.isAuthTokenValid}}),a("span",[t._v(" "+t._s(t.isAuthTokenValid?t.isDeviceOnline?"Device online":"Device offline":"Device state unknown")+" ")])]),a("div",{staticClass:"col-12 text-center d-flex justify-content-center"},[a("span",{staticClass:"input-group-text",attrs:{id:"basic-addon1"}},[t._v("token")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.authToken,expression:"authToken"}],staticClass:"form-control",class:[t.isAuthTokenValid?"is-valid":t.authToken.length>0?"is-invalid":""],attrs:{type:"text",placeholder:"",disabled:t.isAuthTokenValid},domProps:{value:t.authToken},on:{input:function(e){e.target.composing||(t.authToken=e.target.value)}}})])])])])},n=[],o=a("bc3a"),u=a.n(o),l={name:"App",data(){return{userDesiredTemperature:null,measuredTemperature:null,state:null,metadata:null,isRequestInFlight:!1,inErrorState:!1,authToken:"",isAuthTokenValid:!1}},computed:{delta(){return!!this.state&&!(this.state.desired.thermostat_temperature===this.userDesiredTemperature)},timeout(){return 4e3+1200*Math.abs(this.state.reported.thermostat_temperature-this.userDesiredTemperature)},isDeviceOnline(){if(this.state){const t=1e3*this.metadata.reported.thermostat_temperature.timestamp;if(Date.now()-t<9e5)return!0}return!1}},watch:{async authToken(t){if(36===t.length)try{await this.flight(this.retry,[this.getDeviceShadowState,1]),this.userDesiredTemperature=this.state.desired.thermostat_temperature,this.isAuthTokenValid=!0}catch(e){this.isAuthTokenValid=!1,console.log(e)}}},methods:{async flight(t,e){console.log("in flight"),this.isRequestInFlight=!0;const a=await t.apply(this,e);return console.log("landed"),this.isRequestInFlight=!1,a},updateUserDesiredTemperature(t){this.userDesiredTemperature+=t,console.log(this.$route)},async updateSetTemperature(t){const e={method:"post",url:"https://vh3rmjhs10.execute-api.us-east-1.amazonaws.com/test/thermostat/state",headers:{authorization:this.authToken,"Content-Type":"application/json"},data:{state:{desired:{thermostat_temperature:t}}}};try{await u()(e)}catch(a){console.log(a)}await this.wait(this.timeout);try{await this.retry(this.getDeviceShadowState,1)}catch(a){console.log(a)}},async getDeviceShadowState(){console.log("getDeviceShadowState");const t={method:"get",url:"https://vh3rmjhs10.execute-api.us-east-1.amazonaws.com/test/thermostat/state",headers:{authorization:this.authToken,"Content-Type":"application/json"}};let e;try{e=await u()(t)}catch(a){throw new Error("API call failed")}if(this.state=e.data.state,this.metadata=e.data.metadata,this.userDesiredTemperature=this.state.reported.thermostat_temperature,this.state.delta)throw this.inErrorState=!0,new Error("State has delta");this.inErrorState=!1,console.log("refresh compelete")},async retry(t,e){for(let s=0;s<e;s++){console.log("retry");try{return await t.call()}catch(a){console.log(a),await this.wait(this.timeout)}}throw this.inErrorState=!0,new Error("Retry maxed out - something is wrong")},wait(t){return new Promise(e=>setTimeout(e,t))}},async beforeMount(){setInterval(()=>{if(this.isAuthTokenValid&&!this.isRequestInFlight)try{this.getDeviceShadowState()}catch(t){console.log(t)}},6e4)},mounted(){this.$route.query.t&&(this.authToken=this.$route.query.t)}},c=l,d=(a("034f"),a("2877")),h=Object(d["a"])(c,i,n,!1,null,null,null),p=h.exports;a("ab8b");s["a"].use(r["a"]),s["a"].config.productionTip=!1;const m=new r["a"]({mode:"history"});new s["a"]({router:m,render:t=>t(p)}).$mount("#app")},"85ec":function(t,e,a){}});
//# sourceMappingURL=app.bd722a22.js.map